GATEQA PLATFORM HARDENING - UPDATE RECORD
Date: 2026-02-25
Project: GateQA (Vite + React SPA, GitHub Pages)

================================================================
SESSION SUMMARY
================================================================

This record now includes all major work streams completed on 2026-02-25:
1) performance precompute + init cache hardening
2) BUG-007 subtopic contamination fix
3) FilterContext state/actions split enforcement
4) cache migration and storage error hardening
5) SUG-2026-0002 progress import/export manager

================================================================
1) PERFORMANCE / INIT HARDENING
================================================================

Added:
- scripts/precompute-subtopics.mjs

Generated output:
- src/generated/subtopicLookup.json

NPM wiring:
- precompute script added
- start/build now run precompute before app build steps

QuestionService changes:
- INIT_CACHE_VERSION = v2
- cache key now gateqa_init_cache_v2
- _processChunked retained for chunked normalization
- precomputed subject/subtopic maps consumed at runtime

================================================================
2) BUG-007 FIX: SUBTOPIC CONTAMINATION
================================================================

Root cause:
- scraped section-level tags were leaking into individual question tags

Fix implemented:
- MAX_SUBTOPICS_PER_QUESTION = 1
- extractCanonicalSubtopics keeps first matched canonical subtopic only
- scoped subtopic filtering added in FilterContext
- reverse map subtopicToSubjectSlug added

Known limitation:
- genuine multi-subtopic questions can be discoverable only via first matched subtopic

================================================================
3) CONTEXT SPLIT ENFORCEMENT
================================================================

FilterContext split:
- FilterStateContext
- FilterActionsContext

Hooks:
- useFilterState()
- useFilterActions()

Removed:
- useFilters() compatibility hook

Additional action:
- refreshProgressState() for post-import state sync

Migration scope:
- App.jsx and all filter/question/answer components migrated to split hooks

================================================================
4) CACHE MIGRATION AND STORAGE HARDENING
================================================================

QuestionService:
- _readCache() removes legacy gateqa_init_cache_v1 key
- _writeCache() classifies quota errors with isQuotaExceededError()

localStorage utility:
- read/write helpers and quota classification already present and reused

================================================================
5) SUG-2026-0002: PROGRESS MANAGER
================================================================

Added files:
- src/components/ProgressManager/ProgressManager.jsx
- src/components/ProgressManager/ImportConfirmationModal.jsx

Injected into:
- src/components/Filters/FilterSidebar.jsx

Features shipped:
- JSON export of progress
- enriched CSV export (questionUid, year, subject, subtopic, type, status)
- import flow with Merge/Replace confirmation
- schema-version warning path
- quota/write error handling
- refreshProgressState() on successful import
- file input reset in all paths
- inline help popover

================================================================
DATA POLICY UPDATE
================================================================

DataPolicyModal updated with:
- backup guidance using Export JSON
- cross-device transfer instructions using Import
- merge/replace strategy explanation

================================================================
TOOLING CLEANUP
================================================================

Removed dead artifacts:
- scripts/audit-canonical-filters.mjs
- audit:canonical script in package.json

================================================================
TEST STATUS SNAPSHOT
================================================================

Observed:
- 24 unit tests passing

Includes new tests for:
- subtopic cap behavior
- orphan subtopic removal on subject deselect

================================================================
FILES OF INTEREST (2026-02-25 SESSION)
================================================================

Added:
- scripts/precompute-subtopics.mjs
- src/components/ProgressManager/ProgressManager.jsx
- src/components/ProgressManager/ImportConfirmationModal.jsx
- src/contexts/FilterContext.test.jsx

Modified (high impact):
- src/services/QuestionService.js
- src/contexts/FilterContext.jsx
- src/components/Filters/FilterSidebar.jsx
- src/components/Filters/TopicFilter.jsx
- src/components/Filters/YearFilter.jsx
- src/components/Filters/YearRangeFilter.jsx
- src/components/Filters/ActiveFilterChips.jsx
- src/components/Filters/FilterModal.jsx
- src/components/Question/Question.jsx
- src/components/AnswerPanel/AnswerPanel.jsx
- src/components/Footer/DataPolicyModal.jsx
- package.json
- .gitignore

END OF RECORD
